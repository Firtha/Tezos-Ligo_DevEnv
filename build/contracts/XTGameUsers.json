{
  "contractName": "XTGameUsers",
  "abi": [],
  "michelson": "[ { \"prim\": \"parameter\",\n    \"args\":\n      [ { \"prim\": \"or\",\n          \"args\":\n            [ { \"prim\": \"or\",\n                \"args\":\n                  [ { \"prim\": \"or\",\n                      \"args\":\n                        [ { \"prim\": \"or\",\n                            \"args\":\n                              [ { \"prim\": \"address\",\n                                  \"annots\": [ \"%addAdmin\" ] },\n                                { \"prim\": \"address\",\n                                  \"annots\": [ \"%banUser\" ] } ] },\n                          { \"prim\": \"or\",\n                            \"args\":\n                              [ { \"prim\": \"nat\",\n                                  \"annots\": [ \"%injectFund\" ] },\n                                { \"prim\": \"nat\",\n                                  \"annots\": [ \"%injectFundAsUser\" ] } ] } ] },\n                    { \"prim\": \"or\",\n                      \"args\":\n                        [ { \"prim\": \"or\",\n                            \"args\":\n                              [ { \"prim\": \"nat\", \"annots\": [ \"%register\" ] },\n                                { \"prim\": \"nat\",\n                                  \"annots\": [ \"%retrieveFund\" ] } ] },\n                          { \"prim\": \"or\",\n                            \"args\":\n                              [ { \"prim\": \"nat\",\n                                  \"annots\": [ \"%retrieveFundAsUser\" ] },\n                                { \"prim\": \"address\",\n                                  \"annots\": [ \"%rmAdmin\" ] } ] } ] } ] },\n              { \"prim\": \"address\", \"annots\": [ \"%unbanUser\" ] } ] } ] },\n  { \"prim\": \"storage\",\n    \"args\":\n      [ { \"prim\": \"pair\",\n          \"args\":\n            [ { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"set\", \"args\": [ { \"prim\": \"address\" } ],\n                            \"annots\": [ \"%admins\" ] },\n                          { \"prim\": \"set\", \"args\": [ { \"prim\": \"address\" } ],\n                            \"annots\": [ \"%bans\" ] } ] },\n                    { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"nat\",\n                            \"annots\": [ \"%contract_balance\" ] },\n                          { \"prim\": \"address\",\n                            \"annots\": [ \"%contract_owner\" ] } ] } ] },\n              { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"big_map\",\n                      \"args\": [ { \"prim\": \"address\" }, { \"prim\": \"nat\" } ],\n                      \"annots\": [ \"%gameUsers\" ] },\n                    { \"prim\": \"address\", \"annots\": [ \"%games_contract\" ] } ] } ] } ] },\n  { \"prim\": \"code\",\n    \"args\":\n      [ [ { \"prim\": \"LAMBDA\",\n            \"args\":\n              [ { \"prim\": \"pair\",\n                  \"args\":\n                    [ { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"set\",\n                                    \"args\": [ { \"prim\": \"address\" } ] },\n                                  { \"prim\": \"set\",\n                                    \"args\": [ { \"prim\": \"address\" } ] } ] },\n                            { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"nat\" }, { \"prim\": \"address\" } ] } ] },\n                      { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"big_map\",\n                              \"args\":\n                                [ { \"prim\": \"address\" }, { \"prim\": \"nat\" } ] },\n                            { \"prim\": \"address\" } ] } ] }, { \"prim\": \"nat\" },\n                [ { \"prim\": \"CDR\" }, { \"prim\": \"CAR\" }, { \"prim\": \"SOURCE\" },\n                  { \"prim\": \"GET\" },\n                  { \"prim\": \"IF_NONE\",\n                    \"args\":\n                      [ [ { \"prim\": \"PUSH\",\n                            \"args\": [ { \"prim\": \"nat\" }, { \"int\": \"0\" } ] } ],\n                        [] ] } ] ] },\n          { \"prim\": \"LAMBDA\",\n            \"args\":\n              [ { \"prim\": \"pair\",\n                  \"args\":\n                    [ { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"set\",\n                                    \"args\": [ { \"prim\": \"address\" } ] },\n                                  { \"prim\": \"set\",\n                                    \"args\": [ { \"prim\": \"address\" } ] } ] },\n                            { \"prim\": \"pair\",\n                              \"args\":\n                                [ { \"prim\": \"nat\" }, { \"prim\": \"address\" } ] } ] },\n                      { \"prim\": \"pair\",\n                        \"args\":\n                          [ { \"prim\": \"big_map\",\n                              \"args\":\n                                [ { \"prim\": \"address\" }, { \"prim\": \"nat\" } ] },\n                            { \"prim\": \"address\" } ] } ] },\n                { \"prim\": \"unit\" },\n                [ { \"prim\": \"DUP\" }, { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                  { \"prim\": \"CDR\" }, { \"prim\": \"SOURCE\" },\n                  { \"prim\": \"COMPARE\" }, { \"prim\": \"EQ\" }, { \"prim\": \"NOT\" },\n                  { \"prim\": \"IF\",\n                    \"args\":\n                      [ [ { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"SOURCE\" },\n                          { \"prim\": \"MEM\" }, { \"prim\": \"NOT\" },\n                          { \"prim\": \"IF\",\n                            \"args\":\n                              [ [ { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"string\" },\n                                        { \"string\":\n                                            \"Forbidden: You are not admin.\" } ] },\n                                  { \"prim\": \"FAILWITH\" } ],\n                                [ { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"unit\" },\n                                        { \"prim\": \"Unit\" } ] } ] ] } ],\n                        [ { \"prim\": \"DROP\" },\n                          { \"prim\": \"PUSH\",\n                            \"args\":\n                              [ { \"prim\": \"unit\" }, { \"prim\": \"Unit\" } ] } ] ] },\n                  { \"prim\": \"DROP\" }, { \"prim\": \"UNIT\" } ] ] },\n          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n          { \"prim\": \"UNPAIR\" },\n          { \"prim\": \"IF_LEFT\",\n            \"args\":\n              [ [ { \"prim\": \"IF_LEFT\",\n                    \"args\":\n                      [ [ { \"prim\": \"IF_LEFT\",\n                            \"args\":\n                              [ [ { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DROP\" },\n                                  { \"prim\": \"IF_LEFT\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"EXEC\" },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"MEM\" },\n                                          { \"prim\": \"NOT\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"bool\" },\n                                                        { \"prim\": \"True\" } ] },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"UPDATE\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"Warning: This user is already an admin.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ] ] } ],\n                                        [ { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"EXEC\" },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"MEM\" },\n                                          { \"prim\": \"NOT\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"bool\" },\n                                                        { \"prim\": \"True\" } ] },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"UPDATE\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"Warning: This user is already banned.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ] ] } ] ] } ],\n                                [ { \"prim\": \"IF_LEFT\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"EXEC\" },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"DUP\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DUP\",\n                                            \"args\": [ { \"int\": \"4\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"ADD\" },\n                                          { \"prim\": \"PAIR\" },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"PAIR\" },\n                                          { \"prim\": \"PAIR\" } ],\n                                        [ { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"SOURCE\" },\n                                          { \"prim\": \"MEM\" },\n                                          { \"prim\": \"NOT\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"Warning: You are already registered.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ],\n                                                [] ] }, { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"DUP\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DUP\",\n                                            \"args\": [ { \"int\": \"4\" } ] },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"5\" } ] },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"EXEC\" },\n                                          { \"prim\": \"ADD\" },\n                                          { \"prim\": \"SOME\" },\n                                          { \"prim\": \"SOURCE\" },\n                                          { \"prim\": \"UPDATE\" },\n                                          { \"prim\": \"PAIR\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"PAIR\" } ] ] } ] ] } ],\n                        [ { \"prim\": \"IF_LEFT\",\n                            \"args\":\n                              [ [ { \"prim\": \"DIG\",\n                                    \"args\": [ { \"int\": \"3\" } ] },\n                                  { \"prim\": \"DROP\" },\n                                  { \"prim\": \"IF_LEFT\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"SOURCE\" },\n                                          { \"prim\": \"MEM\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"Warning: You are already registered.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ],\n                                                [] ] }, { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"DUP\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"SOME\" },\n                                          { \"prim\": \"SOURCE\" },\n                                          { \"prim\": \"UPDATE\" },\n                                          { \"prim\": \"PAIR\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"PAIR\" } ],\n                                        [ { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"EXEC\" },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUP\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"COMPARE\" },\n                                          { \"prim\": \"GE\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"SUB\" },\n                                                  { \"prim\": \"ABS\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"Warning: Insufficient contract balance.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ] ] } ] ] } ],\n                                [ { \"prim\": \"IF_LEFT\",\n                                    \"args\":\n                                      [ [ { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CDR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"SOURCE\" },\n                                          { \"prim\": \"MEM\" },\n                                          { \"prim\": \"NOT\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"Warning: You are already registered.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ],\n                                                [] ] }, { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"EXEC\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"COMPARE\" },\n                                          { \"prim\": \"LE\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"DROP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"Error: Insufficient fund.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ],\n                                                [ { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"SUB\" },\n                                                  { \"prim\": \"ABS\" },\n                                                  { \"prim\": \"SOME\" },\n                                                  { \"prim\": \"SOURCE\" },\n                                                  { \"prim\": \"UPDATE\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"PAIR\" } ] ] } ],\n                                        [ { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"DIG\",\n                                            \"args\": [ { \"int\": \"3\" } ] },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"EXEC\" },\n                                          { \"prim\": \"DROP\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"CAR\" },\n                                          { \"prim\": \"SWAP\" },\n                                          { \"prim\": \"DUP\" },\n                                          { \"prim\": \"DUG\",\n                                            \"args\": [ { \"int\": \"2\" } ] },\n                                          { \"prim\": \"MEM\" },\n                                          { \"prim\": \"IF\",\n                                            \"args\":\n                                              [ [ { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"DUP\" },\n                                                  { \"prim\": \"DUG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"2\" } ] },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"3\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DUP\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CDR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"CAR\" },\n                                                  { \"prim\": \"DIG\",\n                                                    \"args\":\n                                                      [ { \"int\": \"4\" } ] },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"bool\" },\n                                                        { \"prim\": \"False\" } ] },\n                                                  { \"prim\": \"SWAP\" },\n                                                  { \"prim\": \"UPDATE\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" },\n                                                  { \"prim\": \"PAIR\" } ],\n                                                [ { \"prim\": \"DROP\" },\n                                                  { \"prim\": \"PUSH\",\n                                                    \"args\":\n                                                      [ { \"prim\": \"string\" },\n                                                        { \"string\":\n                                                            \"Warning: This user is not an admin.\" } ] },\n                                                  { \"prim\": \"FAILWITH\" } ] ] } ] ] } ] ] } ] ] } ],\n                [ { \"prim\": \"DIG\", \"args\": [ { \"int\": \"3\" } ] },\n                  { \"prim\": \"DROP\" }, { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"DIG\", \"args\": [ { \"int\": \"3\" } ] },\n                  { \"prim\": \"SWAP\" }, { \"prim\": \"EXEC\" }, { \"prim\": \"DROP\" },\n                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                  { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                  { \"prim\": \"MEM\" },\n                  { \"prim\": \"IF\",\n                    \"args\":\n                      [ [ { \"prim\": \"SWAP\" }, { \"prim\": \"DUP\" },\n                          { \"prim\": \"DUG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"CDR\" },\n                          { \"prim\": \"DUP\", \"args\": [ { \"int\": \"3\" } ] },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                          { \"prim\": \"DUP\", \"args\": [ { \"int\": \"4\" } ] },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                          { \"prim\": \"CDR\" },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"3\" } ] },\n                          { \"prim\": \"PUSH\",\n                            \"args\":\n                              [ { \"prim\": \"bool\" }, { \"prim\": \"False\" } ] },\n                          { \"prim\": \"SWAP\" }, { \"prim\": \"UPDATE\" },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"3\" } ] },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                          { \"prim\": \"CAR\" }, { \"prim\": \"PAIR\" },\n                          { \"prim\": \"PAIR\" }, { \"prim\": \"PAIR\" } ],\n                        [ { \"prim\": \"DROP\" },\n                          { \"prim\": \"PUSH\",\n                            \"args\":\n                              [ { \"prim\": \"string\" },\n                                { \"string\":\n                                    \"Warning: This user has not been banned.\" } ] },\n                          { \"prim\": \"FAILWITH\" } ] ] } ] ] },\n          { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n          { \"prim\": \"PAIR\" } ] ] } ]",
  "source": "//#include \"../utils/XTGameTypes.ligo\"\r\n\r\n// TODO :\r\n// - Allows admins to retrieve only the amount of money they have injected \r\n//      o Add a timestamp so admin can retrieve injected money after a waiting time (with some interests ?)\r\n//\r\n// OPTIONAL :\r\n// - Real management of money (contract's balance (Tezos.balance) and users inject/retrieve)\r\n\r\ntype storage is record\r\n    contract_owner : address;\r\n    contract_balance : nat;\r\n    admins : set(address);\r\n    gameUsers : big_map(address, nat);\r\n    bans : set(address);\r\n\r\n    games_contract : address;\r\nend\r\n\r\n// UTILS\r\n//\r\nfunction getUserBalance(const s : storage) : nat is block {\r\n    const supposed_balance : option (nat) = Big_map.find_opt ((Tezos.source : address), s.gameUsers);\r\n    const actual_balance : nat = case supposed_balance of\r\n    | None -> 0n\r\n    | Some(n) -> n\r\n    end;\r\n} with actual_balance\r\n\r\nfunction checkAdminAccess(const s : storage): unit is block {\r\n    if not (Tezos.source = s.contract_owner)\r\n        then block {\r\n            if not (s.admins contains Tezos.source)\r\n                then failwith (\"Forbidden: You are not admin.\");\r\n            else skip;\r\n        }\r\n    else skip;\r\n} with unit\r\n//\r\n// UTILS\r\n\r\n\r\n// OPERATIONS\r\n//\r\nfunction setGamesContract(const games_addr : address; const s : storage) : storage is\r\n  block {\r\n    if Tezos.source = s.contract_owner\r\n        then s.games_contract := games_addr;\r\n    else failwith (\"Forbidden: You are not the contract's owner.\");\r\n  } with s\r\n\r\nfunction addAdmin (const user : address ; const s : storage) : storage is\r\n  block {\r\n    checkAdminAccess(s);\r\n    if not (s.admins contains user)\r\n        then s.admins := Set.add(user, s.admins);\r\n    else failwith (\"Warning: This user is already an admin.\");\r\n  } with s\r\n\r\nfunction rmAdmin (const user : address ; const s : storage) : storage is\r\n  block {\r\n    checkAdminAccess(s);\r\n\r\n    if s.admins contains user\r\n        then s.admins := Set.remove(user, s.admins);\r\n    else failwith (\"Warning: This user is not an admin.\");\r\n  } with s\r\n\r\nfunction banUser (const user : address ; const s : storage) : storage is\r\n  block {\r\n    checkAdminAccess(s);\r\n\r\n    if not (s.bans contains user)\r\n        then s.bans := Set.add(user, s.bans);\r\n    else failwith (\"Warning: This user is already banned.\");\r\n  } with s\r\n\r\nfunction unbanUser (const user : address ; const s : storage) : storage is\r\n  block {\r\n    checkAdminAccess(s);\r\n\r\n    if s.bans contains user\r\n        then s.bans := Set.remove(user, s.bans);\r\n    else failwith (\"Warning: This user has not been banned.\");\r\n  } with s\r\n\r\nfunction injectFund (const value : nat ; const s : storage) : storage is\r\n  block {\r\n    checkAdminAccess(s);\r\n\r\n    s.contract_balance := s.contract_balance + value;\r\n  } with s\r\n\r\nfunction retrieveFund (const value : nat ; const s : storage) : storage is\r\n  block {\r\n    checkAdminAccess(s);\r\n\r\n    if s.contract_balance >= value \r\n        then s.contract_balance := abs(s.contract_balance - value);\r\n    else failwith (\"Warning: Insufficient contract balance.\");\r\n  } with s\r\n\r\nfunction registerUser (const value : nat ; const s : storage) : storage is\r\n  block {\r\n    if Big_map.mem ((Tezos.source : address), s.gameUsers)\r\n        then failwith (\"Warning: You are already registered.\");\r\n    else skip;\r\n\r\n    s.gameUsers[Tezos.source] := value;\r\n  } with s\r\n\r\nfunction injectFundAsUser (const value : nat ; const s : storage) : storage is\r\n  block {\r\n    if not Big_map.mem ((Tezos.source : address), s.gameUsers)\r\n        then failwith (\"Warning: You are already registered.\");\r\n    else skip;\r\n\r\n    s.gameUsers[Tezos.source] := getUserBalance(s) + value;\r\n  } with s\r\n\r\nfunction retrieveFundAsUser (const value : nat ; const s : storage) : storage is\r\n  block {\r\n    if not Big_map.mem ((Tezos.source : address), s.gameUsers)\r\n        then failwith (\"Warning: You are already registered.\");\r\n    else skip;\r\n\r\n    const my_balance : nat = getUserBalance(s);\r\n    if my_balance <= value\r\n        then failwith (\"Error: Insufficient fund.\");\r\n    else block{\r\n        s.gameUsers[Tezos.source] := abs(my_balance - value);\r\n    };\r\n  } with s\r\n//\r\n// OPERATIONS\r\n\r\n\r\ntype action is\r\n| AddAdmin of address\r\n| RmAdmin of address\r\n| BanUser of address\r\n| UnbanUser of address\r\n| InjectFund of nat\r\n| RetrieveFund of nat\r\n| Register of nat\r\n| InjectFundAsUser of nat\r\n| RetrieveFundAsUser of nat\r\n\r\nfunction main (const p : action ; const s : storage) :\r\n  (list(operation) * storage) is\r\n  block { skip } with ((nil : list(operation)),\r\n  case p of\r\n  // Administration of XTGameUsers\r\n  | AddAdmin(n) -> addAdmin(n, s)\r\n  | RmAdmin(n) -> rmAdmin(n, s)\r\n  | BanUser(n) -> banUser(n, s)\r\n  | UnbanUser(n) -> unbanUser(n, s)\r\n  | InjectFund(n) -> injectFund(n, s)\r\n  | RetrieveFund(n) -> retrieveFund(n, s)\r\n  // Classic use of XTGameUsers\r\n  | Register(n) -> registerUser(n, s)\r\n  | InjectFundAsUser(n) -> injectFundAsUser(n, s)\r\n  | RetrieveFundAsUser(n) -> retrieveFundAsUser(n, s)\r\n  end)\r\n",
  "sourcePath": "/home/vagrant/tezos-workplace/contracts/XTGameUsers.ligo",
  "compiler": {
    "name": "ligo",
    "version": "next"
  },
  "networks": {},
  "schemaVersion": "3.2.0-tezos.1",
  "updatedAt": "2021-04-21T17:06:58.910Z"
}